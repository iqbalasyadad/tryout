{% extends "core/base.html" %}
{% block title %}Review | {{ attempt.package.title }}{% endblock %}
{% block content %}
<style>
  *, *::before, *::after { box-sizing: border-box; }
  .layout { display:flex; gap:16px; align-items:flex-start; }
  .sidebar { width:280px; border:1px solid #ddd; padding:12px; border-radius:5px; max-height: calc(100vh - 24px); overflow-y: auto; }
  .main { flex:1; border:1px solid #ddd; padding:16px; border-radius:5px; font-family: 'Open Sans', Helvetica, Arial, sans-serif;}

  .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:1px; }
  .qbtn { display:flex; align-items:center; justify-content:center; height:30px; border-radius:1px; border:1px solid #ccc; text-decoration:none; font-weight:600; }

  .blank { background:#f4f4f4; border-color:#cfcfcf; color:#555; }
  .answered { background:#e9fff1; border-color:#4bd37b; color:#0b5a26; } /* benar */
  .wrong { background:#ffefef; border-color:#ff8080; color:#8a0000; }   /* salah */
  .flagged { background:#fff8dc; border-color:#ffd24d; color:#6a4b00; } /* ragu */
  .current { background:#e6f0ff; border-color:#2f6bff; color:#113a9c; }

  .option { border:1px solid #ddd; padding:12px; border-radius:5px; margin-bottom:10px; }
  .opt-correct { border-color:#4bd37b; background:#e9fff1; }
  .opt-wrong { border-color:#ff8080; background:#ffefef; }
  .pill { border:1px solid #ddd; padding:6px 10px; border-radius:5px; display:inline-block; }

    .grid { 
    display: grid; 
    grid-template-columns: repeat(5, 1fr); 
    gap: 4px; 
  }
  
  .qbtn { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    height: 36px; 
    border-radius: 4px; 
    border: 1px solid #ccc; 
    text-decoration: none; 
    font-weight: 600; 
    transition: transform 0.1s ease, box-shadow 0.1s ease;
    cursor: pointer;
  }
  
  .qbtn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .qbtn:active:not(:disabled) {
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .layout { flex-direction: column; }
    .sidebar { width: 100%; }
    .grid { grid-template-columns: repeat(10, 1fr); gap: 3px; }
    .qbtn { height: 32px; font-size: 13px; }
    .actions { justify-content: center; }
  }
  .actions { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
    margin-top: 14px; 
  }

  .attempt-review-action-btn {
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ddd;
    background: #fff;
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 14px;
  }
  
  .attempt-review-action-btn:hover:not(:disabled) {
    background-color: #f1f1f1;
    border-color: #bbbbbb;
  }
  
  .attempt-review-action-btn:active:not(:disabled) {
    background-color: #dddddd;
  }
  
  .attempt-review-action-btn:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
  }
</style>

<!-- TOP BAR -->
<div class="topbar" style="font-family: 'Roboto', sans-serif;">
  <div>
    <b>Review & Pembahasan</b><br>
  </div>
  <p class="pill"><b>{{ attempt.package.title }}</b> | Mode: {{ attempt.mode }} | Skor: {{ attempt.score }}/{{ attempt.max_score }}</p>
  <div class="pill" style="margin-bottom:12px;">
    Skor Soal Ini: {{ q_score }}/{{ q_max }}
  </div>
</div>

<div class="layout" style="margin-top:12px;">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h3 style="margin-top:0;">Navigasi</h3>
    <div class="grid">
      {% for g in grid %}
        <a class="qbtn {{ g.status }}" href="?q={{ g.idx }}">{{ g.num }}</a>
      {% endfor %}
    </div>
    <p style="margin-top:12px;">
      <a href="{% url 'attempt_result' attempt.id %}">‚Üê Kembali ke Hasil</a>
    </p>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <!-- <h2 style="margin-top:0;">Soal Nomor {{ idx|add:1 }}</h2> -->

    <div style="white-space:pre-line; margin-bottom:12px;">{{ idx|add:1 }}. {{ q.stem }}</div>

    {% if q.image %}
      <img src="{{ q.image.url }}" style="max-width:350px; border-radius:10px; border:1px solid #eee; margin-bottom:12px;">
    {% endif %}

    {% if q.audio %}
      <audio controls src="{{ q.audio.url }}" style="width:100%; margin-bottom:12px;"></audio>
    {% endif %}

    {% if q.answer_type == "WEIGHTED" %}
      {% for c in choices_view %}
        <div style="display:block;" class="option {% if c.is_selected %}opt-correct{% endif %}">
          <!-- {{ c.label }}. {{ c.text }} -->

          <span>{{ c.label }}.</span>
          {% if c.text %}
            <span>{{ c.text }}</span>
          {% endif %}
          {% if c.image %}
            <span style="display:block;">
              <img src="{{ c.image.url }}" style="max-width:250px; border-radius:6px; border:1px solid #ddd;">
            </span>
          {% endif %}
          {% if c.audio %}
            <span>
              <audio controls preload="none" style="height:35px;">
                <source src="{{ c.audio.url }}">
                Your browser does not support the audio element.
              </audio>
            </span>
          {% endif %}

          <span style="margin-left:8px; opacity:.8;">
            ({{ c.points }} poin)
          </span>

          {% if c.is_selected %}
            <!-- <span style="margin-left:8px;">üéØ</span> -->
          {% endif %}

          {# opsional: tampilkan "Kunci/Ideal" kalau kamu memang pakai is_correct sebagai opsi ideal #}
          {% if c.is_correct %}
            <span style="margin-left:8px;">‚≠ê</span>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      {% for c in choices_view %}
        <div style="display: block;" class="option
          {% if c.is_correct %}opt-correct{% endif %}
          {% if c.is_selected and not c.is_correct %}opt-wrong{% endif %}
        ">
          <!-- {{ c.label }}. {{ c.text }} -->

          <span>{{ c.label }}.</span>
          {% if c.text %}
            <span>{{ c.text }}</span>
          {% endif %}
          {% if c.image %}
            <span style="display:block;">
              <img src="{{ c.image.url }}" style="max-width:250px; border-radius:6px; border:1px solid #ddd;">
            </span>
          {% endif %}
          {% if c.audio %}
            <span>
              <audio controls preload="none" style="height:35px;">
                <source src="{{ c.audio.url }}">
                Your browser does not support the audio element.
              </audio>
            </span>
          {% endif %}

          {% if c.is_correct and c.is_selected %}
            <span style="margin-left:8px;">‚úÖ</span>
            <!-- <span style="margin-left:8px;">üéØ</span> -->
          {% elif c.is_correct %}
            <span style="margin-left:8px;">‚úÖ</span>
          {% elif c.is_selected %}
            <span style="margin-left:8px;">‚ùå</span>
          {% endif %}
        </div>
      {% endfor %}
    {% endif %}

    <br>
    <b>Answer</b>
    <br>
    <br>

    {% if q.explanation %}
      <div style="white-space:pre-line;">{{ q.explanation }}</div>
    {% else %}
      <i>No explanation yet</i>
    {% endif %}
    <br>

    <div class="actions" style="display:flex; gap:10px; margin-top:14px;">

      <button
        class="attempt-review-action-btn" style="min-width: 100px;" 
        type="button"
        onclick="location.href='?q={{ idx|add:-1 }}'"
        {% if idx == 0 %}disabled{% endif %}
      >
        ‚Üê Previous
      </button>

      <button
        class="attempt-review-action-btn" style="min-width: 100px;" 
        type="button"
        onclick="location.href='?q={{ idx|add:1 }}'"
        {% if idx == counts.total|add:"-1" %}disabled{% endif %}
      >
        Next ‚Üí
      </button>
    </div>

  </section>
</div>

{% endblock %}
