{% extends "core/base.html" %}
{% block title %}Review | {{ attempt.package.title }}{% endblock %}
{% block content %}
<style>
  .layout { display:flex; gap:16px; align-items:flex-start; }
  .sidebar { width:280px; border:1px solid #ddd; padding:12px; border-radius:5px; }
  .main { flex:1; border:1px solid #ddd; padding:16px; border-radius:5px; }

  .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:1px; }
  .qbtn { display:flex; align-items:center; justify-content:center; height:30px; border-radius:1px; border:1px solid #ccc; text-decoration:none; font-weight:600; }

  .blank { background:#f4f4f4; border-color:#cfcfcf; color:#555; }
  .answered { background:#e9fff1; border-color:#4bd37b; color:#0b5a26; } /* benar */
  .wrong { background:#ffefef; border-color:#ff8080; color:#8a0000; }   /* salah */
  .flagged { background:#fff8dc; border-color:#ffd24d; color:#6a4b00; } /* ragu */
  .current { background:#e6f0ff; border-color:#2f6bff; color:#113a9c; }

  .option { border:1px solid #ddd; padding:12px; border-radius:5px; margin-bottom:10px; }
  .opt-correct { border-color:#4bd37b; background:#e9fff1; }
  .opt-wrong { border-color:#ff8080; background:#ffefef; }
  .pill { border:1px solid #ddd; padding:6px 10px; border-radius:5px; display:inline-block; }
</style>

<h1>Review & Pembahasan</h1>
<p class="pill"><b>{{ attempt.package.title }}</b> | Skor: {{ attempt.score }}/{{ attempt.max_score }}</p>
<div class="pill" style="margin-bottom:12px;">
  Skor Soal Ini: {{ q_score }}/{{ q_max }}
</div>

<div class="layout" style="margin-top:12px;">
  <aside class="sidebar">
    <h3 style="margin-top:0;">Navigasi</h3>
    <div class="grid">
      {% for g in grid %}
        <a class="qbtn {{ g.status }}" href="?q={{ g.idx }}">{{ g.num }}</a>
      {% endfor %}
    </div>

    <p style="margin-top:12px;">
      <a href="{% url 'attempt_result' attempt.id %}">‚Üê Kembali ke Hasil</a>
    </p>
  </aside>

  <section class="main">
    <h2 style="margin-top:0;">Soal Nomor {{ idx|add:1 }}</h2>

    <div style="white-space:pre-line; margin-bottom:12px;">{{ q.stem }}</div>

    {% if q.image %}
      <img src="{{ q.image.url }}" style="max-width:100%; border-radius:10px; border:1px solid #eee; margin-bottom:12px;">
    {% endif %}

    {% if q.audio %}
      <audio controls src="{{ q.audio.url }}" style="width:100%; margin-bottom:12px;"></audio>
    {% endif %}

    <h3>Jawaban</h3>

    {% if q.answer_type == "WEIGHTED" %}
      {% for c in choices_view %}
        <div class="option {% if c.is_selected %}opt-correct{% endif %}">
          {{ c.label }}. {{ c.text }}
          <span style="margin-left:8px; opacity:.8;">
            ({{ c.points }} poin)
          </span>

          {% if c.is_selected %}
            <span style="margin-left:8px;">üéØ Dipilih</span>
          {% endif %}

          {# opsional: tampilkan "Kunci/Ideal" kalau kamu memang pakai is_correct sebagai opsi ideal #}
          {% if c.is_correct %}
            <span style="margin-left:8px;">‚≠ê Ideal</span>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      {% for c in choices_view %}
        <div class="option
          {% if c.is_correct %}opt-correct{% endif %}
          {% if c.is_selected and not c.is_correct %}opt-wrong{% endif %}
        ">
          {{ c.label }}. {{ c.text }}

          {% if c.is_correct and c.is_selected %}
            <span style="margin-left:8px;">‚úÖ Benar</span>
            <span style="margin-left:8px;">üéØ Pilihan kamu</span>
          {% elif c.is_correct %}
            <span style="margin-left:8px;">‚úÖ Benar</span>
          {% elif c.is_selected %}
            <span style="margin-left:8px;">‚ùå Pilihan kamu</span>
          {% endif %}
        </div>
      {% endfor %}
    {% endif %}



    <h3>Pembahasan</h3>
    {% if q.explanation %}
      <div style="white-space:pre-line;">{{ q.explanation }}</div>
    {% else %}
      <i>Belum ada pembahasan untuk soal ini.</i>
    {% endif %}

    <div style="display:flex; gap:10px; margin-top:14px;">
      <a href="?q={{ idx|add:-1 }}">‚Üê Prev</a>
      <a href="?q={{ idx|add:1 }}">Next ‚Üí</a>
    </div>
  </section>
</div>
{% endblock %}
